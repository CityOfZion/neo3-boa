version: 2.1

executors:
  python311-executor:
    docker:
      - image: cimg/python:3.11.12
  python312-executor:
    docker:
      - image: cimg/python:3.12.0

orbs:
  python: circleci/python@0.1.2

jobs:
  unit-test-311: &unit-test
    working_directory: ~/neo3-boa
    executor: python311-executor
    steps:
      - checkout
      #      - python/load-cache
      - run:
          name: Test Build Package
          command: |
            python3 -m pip install --upgrade pip
            pip install twine build
            python3 -m build
            twine check dist/*

      - run:
          name: Fix openssl for ripemd160 loading
          command: |
            wget https://gist.githubusercontent.com/ixje/9bfde300b660276abc98761f7dc32839/raw/95aea8da07dcead2949ac266fbacc47bbf6a1881/fix-ripemd160-loading.py
            sudo -E python fix-ripemd160-loading.py
            python -c "import hashlib;print(hashlib.new('ripemd160'))"

#      - python/save-cache

workflows:
  version: 2
  build_test_deploy:
    jobs:
      - unit-test-311:
         filters:
           tags:
             only: /.*/
